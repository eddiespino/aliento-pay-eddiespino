<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prueba de Curaci√≥n - Debug</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
        font-weight: bold;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      button {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background-color: #0056b3;
      }
      .console-output {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        padding: 10px;
        margin-top: 10px;
        font-family: monospace;
        white-space: pre-wrap;
        max-height: 400px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîç Prueba de Debug - Curaci√≥n</h1>

      <div class="info">
        <strong>Objetivo:</strong> Verificar que las funciones de curaci√≥n est√°n funcionando
        correctamente
      </div>

      <div id="status-area">
        <div class="status info">‚è≥ Iniciando pruebas...</div>
      </div>

      <div>
        <button onclick="testCurationFunction()">üß™ Probar Funci√≥n de Curaci√≥n</button>
        <button onclick="testApiEndpoint()">üåê Probar Endpoint Directo</button>
        <button onclick="simulateUserAuth()">üë§ Simular Usuario</button>
        <button onclick="clearConsole()">üóëÔ∏è Limpiar Console</button>
      </div>

      <div class="console-output" id="console-output"></div>
    </div>

    <script>
      // Funci√≥n para mostrar mensajes en la consola visual
      function addToConsole(message, type = 'info') {
        const consoleOutput = document.getElementById('console-output');
        const timestamp = new Date().toLocaleTimeString();
        const formattedMessage = `[${timestamp}] ${message}\n`;
        consoleOutput.textContent += formattedMessage;
        consoleOutput.scrollTop = consoleOutput.scrollHeight;

        // Tambi√©n en la consola del navegador
        if (type === 'error') {
          console.error(message);
        } else if (type === 'warn') {
          console.warn(message);
        } else {
          console.log(message);
        }
      }

      function updateStatus(message, type = 'info') {
        const statusArea = document.getElementById('status-area');
        const statusClass = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
        statusArea.innerHTML = `<div class="status ${statusClass}">${message}</div>`;
      }

      // Simular usuario autenticado
      function simulateUserAuth() {
        localStorage.setItem('authenticated_user', 'testuser');
        addToConsole('‚úÖ Usuario simulado configurado: testuser');
        updateStatus('‚úÖ Usuario simulado configurado', 'success');
      }

      // Funci√≥n para probar la API directamente
      async function testApiEndpoint() {
        addToConsole('üåê Probando endpoint /api/curation-stats...');

        try {
          const response = await fetch('/api/curation-stats');
          const data = await response.json();

          if (response.ok) {
            addToConsole('‚úÖ Endpoint respondi√≥ correctamente');
            addToConsole(`üìä Datos recibidos: ${JSON.stringify(data, null, 2)}`);
            updateStatus('‚úÖ Endpoint funciona correctamente', 'success');
          } else {
            addToConsole(
              `‚ùå Error en endpoint: ${response.status} ${response.statusText}`,
              'error'
            );
            addToConsole(`üìã Respuesta: ${JSON.stringify(data, null, 2)}`);
            updateStatus('‚ùå Error en endpoint', 'error');
          }
        } catch (error) {
          addToConsole(`‚ùå Error de red: ${error.message}`, 'error');
          updateStatus('‚ùå Error de red', 'error');
        }
      }

      // Funci√≥n para probar la funci√≥n de curaci√≥n (simular la del dashboard)
      async function testCurationFunction() {
        addToConsole('üß™ Probando funci√≥n de curaci√≥n...');

        // Simular la funci√≥n getCurationStatsData
        const getCurationStatsData = async () => {
          addToConsole('üì° Iniciando getCurationStatsData...');

          const response = await fetch('/api/curation-stats');
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();
          addToConsole('‚úÖ Datos obtenidos de la API');

          return data;
        };

        try {
          const data = await getCurationStatsData();
          addToConsole('‚úÖ Funci√≥n de curaci√≥n ejecutada exitosamente');
          addToConsole(`üìä Resultado: ${JSON.stringify(data, null, 2)}`);
          updateStatus('‚úÖ Funci√≥n de curaci√≥n funciona correctamente', 'success');
        } catch (error) {
          addToConsole(`‚ùå Error en funci√≥n de curaci√≥n: ${error.message}`, 'error');
          updateStatus('‚ùå Error en funci√≥n de curaci√≥n', 'error');
        }
      }

      function clearConsole() {
        document.getElementById('console-output').textContent = '';
        addToConsole('üóëÔ∏è Consola limpiada');
      }

      // Inicializar al cargar la p√°gina
      document.addEventListener('DOMContentLoaded', () => {
        addToConsole('üöÄ P√°gina de debug cargada');
        updateStatus('üöÄ P√°gina de debug lista', 'info');

        // Verificar si hay usuario autenticado
        const user = localStorage.getItem('authenticated_user');
        if (user) {
          addToConsole(`üë§ Usuario encontrado: ${user}`);
        } else {
          addToConsole('üë§ No hay usuario autenticado');
        }
      });
    </script>
  </body>
</html>
