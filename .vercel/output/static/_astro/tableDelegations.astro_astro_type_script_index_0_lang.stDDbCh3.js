const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/Container.WlziK8FN.js","_astro/index.BYO3pZyk.js","_astro/preload-helper.BlTxHScW.js","_astro/HiveAccountService.D7iZ8Fsv.js","_astro/get-delegations.Crr_gJ4V.js"])))=>i.map(i=>d[i]);
import{_ as $}from"./preload-helper.BlTxHScW.js";const f="delegationsCache",P=3*60*1e3;function S(e){return`${f}_${e}`}let E=null;async function O(){if(!E){const{getAvatarCache:e}=await $(async()=>{const{getAvatarCache:o}=await import("./avatar-cache.GCLNzyIK.js");return{getAvatarCache:o}},[]);E=e()}return E}async function W(e){return e?(await O()).getAvatarUrl(e):""}let s=[],C=!1,v=!1,u=null,p=null;const K=document.getElementById("loading-state"),z=document.getElementById("error-state"),M=document.getElementById("table-container"),R=document.getElementById("empty-state"),x=document.getElementById("delegations-tbody"),_=document.getElementById("total-delegations"),D=document.getElementById("total-hp-display"),T=document.getElementById("loading-progress"),B=document.getElementById("error-message"),F=document.getElementById("refresh-btn"),y=document.getElementById("refresh-icon"),j=document.getElementById("retry-btn"),I=document.getElementById("skeleton-state");function w(e="Cargando delegaciones..."){if(b(),I)I.classList.remove("hidden"),T&&(T.textContent=e);else{K?.classList.remove("hidden");const o=document.getElementById("loading-progress-fallback");o&&(o.textContent=e)}}function H(e="Something went wrong"){b(),z?.classList.remove("hidden"),B&&(B.textContent=e)}function k(){b(),M?.classList.remove("hidden")}function J(){b(),R?.classList.remove("hidden")}function b(){I?.classList.add("hidden"),K?.classList.add("hidden"),z?.classList.add("hidden"),M?.classList.add("hidden"),R?.classList.add("hidden")}async function U(e){if(!x)return;x.innerHTML="";const o=e.map(r=>r.delegator).filter(Boolean);await(await O()).preloadAvatars(o);for(const[r,l]of e.entries()){const n=document.createElement("tr");n.className=`border-b border-[#232329] hover:bg-[#1a1a1d] transition-colors ${r%2===0?"bg-[#18181b]":"bg-[#1a1a1d]"}`;const a=l,t=await W(a.delegator);n.innerHTML=`
        <td class="py-4 px-6">
          <div class="flex items-center gap-3">
            <img 
              src="${t}" 
              alt="@${a.delegator}" 
              class="w-8 h-8 rounded-full object-cover bg-gray-600"
              onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
            />
            <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center text-white text-sm font-bold" style="display: none;">
              ${a.delegator.substring(0,2).toUpperCase()}
            </div>
            <div>
              <p class="text-white text-xl font-medium">@${a.delegator}</p>
              <p class="text-gray-400 text-xs">Block: <a href="https://hivehub.dev/b/${a.block_num||""}" target="_blank" class="text-blue-100 hover:text-blue-200 ">${a.block_num||"Loading..."}</a></p>
            </div>
          </div>
        </td>
        <td class="py-4 px-6">
          <p class="text-green-400 font-bold text-lg">${a.hpAmount.toLocaleString("en-US")} HP</p>
          <p class="text-gray-400 text-xs">Hive Power</p>
        </td>
        <td class="py-4 px-6">
          <div class="flex items-center gap-2">
            <p class="text-blue-400 font-bold text-lg">${(a.participationPercentage||0).toFixed(2)}%</p>
            <div class="w-16 bg-gray-700 rounded-full h-2">
              <div 
                class="bg-gradient-to-r from-blue-400 to-blue-600 h-2 rounded-full transition-all duration-300" 
                style="width: ${Math.min(100,a.participationPercentage||0)}%"
              ></div>
            </div>
          </div>
          <p class="text-gray-400 text-xs">of total HP</p>
        </td>
      `,x.appendChild(n)}const i=e.reduce((r,l)=>r+(l.hpAmount||0),0);_&&(_.textContent=e.length.toString()),D&&(D.textContent=`${i.toLocaleString("en-US")} HP`),window.dispatchEvent(new CustomEvent("delegations:totalHP",{detail:i}))}async function L(){if(C){console.log("âš ï¸ Ya estÃ¡ cargando delegaciones, saltando...");return}if(u)return console.log("â³ Esperando carga en progreso..."),u;p&&(p.abort(),console.log("ðŸš« Cancelando requests HTTP previos de delegaciones")),p=new AbortController;let e=null;return u=(async()=>{try{C=!0,w("Getting logged user...");const{container:o}=await $(async()=>{const{container:t}=await import("./Container.WlziK8FN.js");return{container:t}},__vite__mapDeps([0,1,2,3]));if(e=o.getAuthenticationUseCase().getCurrentUser(),!e){H("No user logged in. Please login first.");return}if(p?.signal.aborted){console.log("ðŸš« Carga de delegaciones cancelada");return}const i=S(e),r=localStorage.getItem(i);if(r)try{const t=JSON.parse(r),c=Date.now();if(c-t.timestamp<P){console.log(`âš¡ Using cached data for @${e}`),s=t.delegations;const A=s.reduce((d,g)=>d+(g.hpAmount||0),0),h=s.map(d=>{const g=A>0?d.hpAmount/A*100:0;return{...d,participationPercentage:g}});await U(h),k();const N=Math.floor((c-t.timestamp)/1e3);console.log(`ðŸ“¦ Cache age: ${N}s (expires in ${Math.floor((P-(c-t.timestamp))/1e3)}s)`),console.log("ðŸ“Š Resumen de participaciÃ³n (desde cache):"),h.slice(0,5).forEach((d,g)=>{console.log(`  ${g+1}. @${d.delegator}: ${d.participationPercentage.toFixed(2)}%`)}),h.length>5&&console.log(`  ... y ${h.length-5} delegadores mÃ¡s`);return}else console.log(`ðŸ—‘ï¸ Cache expired for @${e}, loading fresh data`),localStorage.removeItem(i)}catch(t){console.warn("âš ï¸ Error parsing cache, clearing:",t),localStorage.removeItem(i)}w(`Loading delegations for @${e}...`),w("Loading basic delegation data...");const{getAllDelegationsWithDetails:l}=await $(async()=>{const{getAllDelegationsWithDetails:t}=await import("./get-delegations.Crr_gJ4V.js");return{getAllDelegationsWithDetails:t}},__vite__mapDeps([4,1,2]));if(s=await l(e),!s||s.length===0){J(),console.log(`â„¹ï¸ No delegations found for @${e}`);return}const n=s.reduce((t,c)=>t+(c.hpAmount||0),0);console.log(`ðŸ“Š Total HP calculado: ${n.toLocaleString("en-US")} HP`);const a=s.map(t=>{const c=n>0?t.hpAmount/n*100:0;return console.log(`ðŸ“ˆ @${t.delegator}: ${t.hpAmount.toLocaleString("en-US")} HP (${c.toFixed(2)}%)`),{delegator:t.delegator,hpAmount:t.hpAmount,participationPercentage:c,vestsAmount:t.amount,block_num:t.operation_details?.block_num||t.block_num}});await U(a),k(),console.log(`âœ… Loaded ${a.length} delegations with essential data only (OPTIMIZED)`),console.log("ðŸ“Š Resumen de participaciÃ³n:"),a.slice(0,5).forEach((t,c)=>{console.log(`  ${c+1}. @${t.delegator}: ${t.participationPercentage.toFixed(2)}%`)}),a.length>5&&console.log(`  ... y ${a.length-5} delegadores mÃ¡s`),console.log("âš¡ Dashboard optimizado: Columnas de fecha y transacciÃ³n eliminadas para mÃ¡xima velocidad")}catch(o){if(o instanceof Error&&o.name==="AbortError"){console.log("ðŸš« Carga de delegaciones cancelada correctamente");return}console.error("âŒ Error loading delegations:",o),H(o?.message||"Failed to load delegations")}finally{if(s&&s.length>0&&e){const o=S(e),m=s.reduce((l,n)=>l+(n.hpAmount||0),0),i=s.map(l=>({...l,participationPercentage:m>0?l.hpAmount/m*100:0})),r={delegations:i,timestamp:Date.now(),username:e};try{const n=Object.keys(localStorage).filter(a=>a.startsWith(f)&&a!==o);n.forEach(a=>{try{localStorage.removeItem(a)}catch(t){console.warn("âš ï¸ Error removing old cache entry:",t)}}),localStorage.setItem(o,JSON.stringify(r)),console.log(`ðŸ’¾ Cached ${i.length} delegations with percentages for @${e}`),n.length>0&&console.log(`ðŸ§¹ Cleaned ${n.length} old cache entries`)}catch(l){console.warn("âš ï¸ Error saving to cache:",l);try{Object.keys(localStorage).filter(t=>t.startsWith(f)).forEach(t=>localStorage.removeItem(t)),localStorage.setItem(o,JSON.stringify(r)),console.log("ðŸ”„ Retry cache save successful after cleanup")}catch(n){console.warn("âš ï¸ Retry cache save failed:",n)}}}C=!1,v=!0,u=null,y&&y.classList.remove("animate-spin")}})(),u}F?.addEventListener("click",()=>{y&&y.classList.add("animate-spin"),Object.keys(localStorage).forEach(e=>{e.startsWith(f)&&localStorage.removeItem(e)}),console.log("ðŸ§¹ Cleared all delegation caches"),v=!1,L()});j?.addEventListener("click",()=>{v=!1,L()});function V(){if(v){console.log("âš ï¸ Tabla de delegaciones ya inicializada, saltando...");return}console.log("ðŸŽ¯ Table Delegations component initialized"),L()}function Y(){console.log("ðŸ”§ Configurando inicializaciÃ³n de tabla de delegaciones...");function e(o){console.log(`ðŸ“¡ Tabla: ${o} event`),V()}document.addEventListener("DOMContentLoaded",()=>e("DOMContentLoaded"),{once:!0}),document.addEventListener("astro:page-load",()=>e("Astro page load"),{once:!0}),document.addEventListener("aliento:page-ready",()=>e("PÃ¡gina lista"),{once:!0}),(document.readyState==="complete"||document.readyState==="interactive")&&(console.log("âš¡ Tabla: PÃ¡gina ya lista, inicializando inmediatamente"),setTimeout(()=>e("Inmediata"),50))}Y();
