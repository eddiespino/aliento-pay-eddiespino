const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/user-session-watcher.37jLKIro.js","_astro/preload-helper.BlTxHScW.js","_astro/user-cache.CDKUo8H3.js"])))=>i.map(i=>d[i]);
import{_ as h}from"./preload-helper.BlTxHScW.js";if(typeof window<"u"){let g=function(){s()&&i(),D(),y()},s=function(){try{if(typeof window.userCache<"u"){const _=window.userCache.getAge("curation_stats"),b=window.userCache.getAge("dashboard_data");return!(_!==null&&_<6e5&&b!==null&&b<9e5)}const a=localStorage.getItem("dashboard_curation_stats");if(!a)return!0;const o=JSON.parse(a),n=Date.now()-o.timestamp,r=10*60*1e3;if(n>r)return!0;const e=localStorage.getItem("dashboard_last_update");if(!e)return!0;const t=Date.now()-parseInt(e,10),u=15*60*1e3;return t>u}catch(a){return console.warn("‚ö†Ô∏è Error verificando necesidad de actualizaci√≥n:",a),!0}},i=function(){if(c){console.log("‚ö†Ô∏è Ya hay una actualizaci√≥n programada, saltando...");return}console.log("‚è∞ Programando actualizaci√≥n de datos..."),c=!0,setTimeout(async()=>{try{await w()}catch(a){console.error("‚ùå Error en actualizaci√≥n programada:",a)}finally{c=!1}},1500)},D=function(){console.log("üß≠ Configurando listeners de navegaci√≥n"),document.addEventListener("astro:page-load",function(){s()&&i()}),document.addEventListener("visibilitychange",function(){!document.hidden&&window.location.pathname==="/dashboard"&&(console.log("üëÅÔ∏è Dashboard visible de nuevo, verificando datos"),s()&&(console.log("üîÑ Actualizando datos tras volver a hacer visible"),i()))})},y=function(){console.log("‚è∞ Configurando actualizaciones peri√≥dicas"),setInterval(()=>{!document.hidden&&window.location.pathname==="/dashboard"&&(console.log("‚è∞ Actualizaci√≥n peri√≥dica programada"),s()&&i())},6e5)};(async()=>{try{const{userCache:a,initializeUserCache:o}=await h(async()=>{const{userCache:e,initializeUserCache:t}=await import("./user-cache.CDKUo8H3.js").then(u=>u.a);return{userCache:e,initializeUserCache:t}},[]);window.userCache=a,o(),console.log("‚úÖ Dashboard: Sistema de cach√© por usuario inicializado");const{initializeUserSessionWatcher:n,onUserSessionChange:r}=await h(async()=>{const{initializeUserSessionWatcher:e,onUserSessionChange:t}=await import("./user-session-watcher.37jLKIro.js");return{initializeUserSessionWatcher:e,onUserSessionChange:t}},__vite__mapDeps([0,1,2]));n(),r((e,t)=>{e&&t&&e!==t?(console.log("üîÑ Dashboard: Usuario cambi√≥, refrescando p√°gina..."),window.location.reload()):e&&!t&&(console.log("üîÑ Dashboard: Usuario deslogueado, redirigiendo..."),window.location.href="/")}),console.log("‚úÖ Dashboard: Vigilante de sesi√≥n inicializado")}catch{console.warn("‚ö†Ô∏è Dashboard: Error cargando sistemas de usuario, usando fallback")}})();const d=localStorage.getItem("authenticated_user"),f=document.getElementById("user-greeting"),m=document.getElementById("user-avatar");d&&(f&&(f.textContent=`@${d}`),m&&(m.textContent=d.charAt(0).toUpperCase()));const p=document.getElementById("logout-btn");p&&(p.onclick=async()=>{try{const a=localStorage.getItem("authenticated_user");try{const{handleUserLogout:o}=await h(async()=>{const{handleUserLogout:n}=await import("./user-session-watcher.37jLKIro.js");return{handleUserLogout:n}},__vite__mapDeps([0,1,2]));o(a||void 0),console.log("‚úÖ Dashboard: Logout procesado con nuevo sistema")}catch{console.warn("‚ö†Ô∏è Dashboard: Error importando sistema de logout, usando fallback"),localStorage.removeItem("authenticated_user"),typeof window.userCache<"u"?window.userCache.clearUserCache():(localStorage.removeItem("dashboard_curation_stats"),localStorage.removeItem("dashboard_delegation_stats"),localStorage.removeItem("dashboard_last_update"))}}catch(a){console.warn("‚ö†Ô∏è Error limpiando cach√© en logout:",a)}setTimeout(()=>{window.location.href="/"},100)});let c=!1,l=!1;async function w(){if(l){console.log("‚ö†Ô∏è Ya hay una actualizaci√≥n de dashboard en curso, saltando...");return}console.log("üîÑ Actualizando datos del dashboard..."),l=!0;try{typeof window.refreshCurationStats=="function"&&await window.refreshCurationStats(),typeof window.userCache<"u"?window.userCache.set("dashboard_data",{lastUpdate:Date.now()}):localStorage.setItem("dashboard_last_update",Date.now().toString()),console.log("‚úÖ Dashboard data actualizado exitosamente");const a=new CustomEvent("dashboard-data-updated",{detail:{timestamp:Date.now()}});document.dispatchEvent(a)}catch(a){console.error("‚ùå Error actualizando datos del Dashboard:",a)}finally{l=!1}}window.forceRefreshDashboard=async function(){console.log("üîÑ Forzando actualizaci√≥n completa del Dashboard");try{localStorage.removeItem("dashboard_curation_stats"),localStorage.removeItem("dashboard_delegation_stats"),localStorage.removeItem("dashboard_last_update"),await w(),window.location.reload()}catch(a){console.error("‚ùå Error en actualizaci√≥n forzada:",a)}},window.getDashboardCacheInfo=function(){try{const a=localStorage.getItem("dashboard_curation_stats"),o=localStorage.getItem("dashboard_delegation_stats"),n=localStorage.getItem("dashboard_last_update"),r={hasCurationData:!!a,hasDelegationData:!!o,lastUpdate:n?parseInt(n,10):null,curationAge:a?Date.now()-JSON.parse(a).timestamp:null,needsUpdate:s()};return console.log("üìä Informaci√≥n del cach√© del Dashboard:",r),r}catch(a){return console.warn("‚ö†Ô∏è Error obteniendo informaci√≥n del cach√©:",a),null}},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",g):g()}
