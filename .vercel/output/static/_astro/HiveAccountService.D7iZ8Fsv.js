const c=a=>a.length>=3&&a.length<=16&&/^[a-z0-9.-]+$/.test(a),o=a=>{const e=a.trim().toLowerCase();if(!c(e))throw new Error(`Invalid username: ${a}`);return e},u=a=>{if(a<0)throw new Error("HP amount cannot be negative");if(!Number.isFinite(a))throw new Error("HP amount must be a finite number");return a};class m{static calculatePersonalHP(e,r){try{const t=parseFloat(e)||0,s=parseFloat(r)||0;if(!Number.isFinite(t)||!Number.isFinite(s))return{success:!1,error:new Error("Invalid HP values provided")};const i=t===0?s:t-s;return{success:!0,data:u(Math.max(0,i))}}catch(t){return{success:!1,error:t}}}static toUserProfile(e){try{const r=this.calculatePersonalHP(e.incoming_hp,e.outgoing_hp);if(!r.success)return{success:!1,error:r.error};const t=this.parseReputation(e.reputation);return{success:!0,data:{username:o(e.name),displayName:e.posting_metadata?.profile?.name||e.name,reputation:t,personalHP:r.data,incomingHP:parseFloat(e.incoming_hp)||0,outgoingHP:parseFloat(e.outgoing_hp)||0,profileImage:e.posting_metadata?.profile?.profile_image||void 0,createdAt:new Date(e.created_at)}}}catch(r){return{success:!1,error:r}}}static formatHP(e){return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:3}).format(e)}static parseReputation(e){return parseFloat(e)||0}static formatReputation(e){return e.toFixed(2)}static validateUsername(e){try{return{success:!0,data:o(e)}}catch(r){return{success:!1,error:r}}}static isValidUsername(e){return c(e)}static normalizeUsername(e){return e.trim().toLowerCase()}static async getHPEquivalent(e){try{const r=this.normalizeUsername(e),t=await fetch(`https://hafsql-api.mahdiyari.info/balances/by-names?names=${r}`);if(!t.ok)return{success:!1,error:new Error(`HTTP error! status: ${t.status}`)};const s=await t.json();if(!Array.isArray(s)||s.length===0)return{success:!1,error:new Error("No account data found")};const i=s[0],n=parseFloat(i.hp_equivalent);return Number.isFinite(n)?{success:!0,data:n}:{success:!1,error:new Error("Invalid HP equivalent value")}}catch(r){return{success:!1,error:r}}}static async getIncomingHP(e){try{const r=this.normalizeUsername(e),t=await fetch(`https://hafsql-api.mahdiyari.info/accounts/by-names?names=${r}`);if(!t.ok)return{success:!1,error:new Error(`HTTP error! status: ${t.status}`)};const s=await t.json();if(!Array.isArray(s)||s.length===0)return{success:!1,error:new Error("No account data found")};const i=s[0],n=parseFloat(i.incoming_hp);return Number.isFinite(n)?{success:!0,data:n}:{success:!1,error:new Error("Invalid incoming HP value")}}catch(r){return{success:!1,error:r}}}static async calculateHPPercentage(e){try{const[r,t]=await Promise.all([this.getHPEquivalent(e),this.getIncomingHP(e)]);if(!r.success)return{success:!1,error:r.error};if(!t.success)return{success:!1,error:t.error};const s=r.data,n=t.data+s;return n===0?{success:!1,error:new Error("Total HP is zero, cannot calculate percentage")}:{success:!0,data:s/n*100}}catch(r){return{success:!1,error:r}}}}function f(a){return a?`https://images.hive.blog/u/${a.replace("@","").trim().toLowerCase()}/avatar`:""}export{m as HiveAccountService,f as getHiveAvatarUrl};
