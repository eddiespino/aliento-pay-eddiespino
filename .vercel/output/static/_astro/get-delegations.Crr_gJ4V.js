import{u as i}from"./index.BYO3pZyk.js";import"./preload-helper.BlTxHScW.js";let s=null;const c=5*60*1e3;async function l(){const n=Date.now();if(s&&n-s.timestamp<c)return s;console.log("üîÑ Obteniendo propiedades globales de Hive (cache expirado o vac√≠o)...");const e=s?.chain||await i(),t=await e.api.database_api.get_dynamic_global_properties();return s={total_vesting_fund_hive:t.total_vesting_fund_hive,total_vesting_shares:t.total_vesting_shares,timestamp:n,chain:e},console.log("‚úÖ Propiedades globales cacheadas:",{total_vesting_fund_hive:t.total_vesting_fund_hive,total_vesting_shares:t.total_vesting_shares}),s}async function g(n){try{const e=await i();if(!e)throw new Error("Hive chain not initialized");const t={"balance-api":{accounts:{delegations:{urlPath:"{accountName}/delegations"}}}},o=await e.extendRest(t).restApi["balance-api"].accounts.delegations({accountName:n});return!o||typeof o!="object"?(console.warn("Response does not have expected structure:",o),[]):o.incoming_delegations||[]}catch(e){return console.error(`Error fetching vesting delegations for ${n}:`,e),[]}}async function h(n){if(n.length===0)return[];console.log(`üîÑ Convirtiendo ${n.length} delegaciones a HP en lote...`);try{const e=await l(),t=n.map(a=>{try{const o=e.chain.vestsToHp(a.amount,e.total_vesting_fund_hive,e.total_vesting_shares);return{...a,hpAmount:parseFloat(o.amount)/1e3}}catch{const r=parseFloat(a.amount);return{...a,hpAmount:r*.0005993102}}});return console.log(`‚úÖ Convertidas ${t.length} delegaciones a HP`),t}catch(e){return console.error("Error en conversi√≥n en lote:",e),n.map(t=>({...t,hpAmount:parseFloat(t.amount)*.0005993102}))}}async function u(n){try{console.log(`üöÄ Obteniendo delegaciones completas para @${n}...`);const e=await g(n);if(console.log(`üìä Encontradas ${e.length} delegaciones b√°sicas`),e.length===0)return[];const t=await h(e);console.log(`üí∞ Convertidas ${t.length} delegaciones a HP`);const a=t.map(o=>({...o}));return console.log(`‚úÖ Preparadas ${a.length} delegaciones para dashboard`),a}catch(e){return console.error("‚ùå Error en getAllDelegationsWithDetails:",e),[]}}export{h as convertDelegationsToHP,g as getAllDelegationsIncoming,u as getAllDelegationsWithDetails};
