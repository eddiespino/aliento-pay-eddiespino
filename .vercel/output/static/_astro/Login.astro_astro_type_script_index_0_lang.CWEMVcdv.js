const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/Container.WlziK8FN.js","_astro/index.BYO3pZyk.js","_astro/preload-helper.BlTxHScW.js","_astro/HiveAccountService.D7iZ8Fsv.js"])))=>i.map(i=>d[i]);
import{_ as L}from"./preload-helper.BlTxHScW.js";window.addEventListener("DOMContentLoaded",async()=>{const{container:c}=await L(async()=>{const{container:e}=await import("./Container.WlziK8FN.js");return{container:e}},__vite__mapDeps([0,1,2,3])),{createLoadingManager:k,LoadingSteps:B}=await L(async()=>{const{createLoadingManager:e,LoadingSteps:n}=await import("./loading-manager.Crc9mKyj.js");return{createLoadingManager:e,LoadingSteps:n}},[]),I=c.getAuthenticationUseCase(),l=document.getElementById("login-form"),s=document.getElementById("login-error"),h=document.getElementById("error-text"),f=document.getElementById("login-button"),w=document.getElementById("login-button-text"),v=document.getElementById("login-spinner"),a=document.getElementById("loading-text"),E=document.getElementById("loading-states"),d=document.getElementById("step-keychain"),u=document.getElementById("step-account"),g=document.getElementById("step-signature"),y=document.getElementById("step-session"),S=k({minDuration:800,maxDuration:15e3}).setSteps(B.AUTH).onStepChange((e,n)=>{const t={keychain:d,account:u,signature:g,session:y}[e.id];t&&C(t,e.message)}).onComplete(()=>{i(y),setTimeout(()=>{window.location.href="/dashboard"},500)}).onError(e=>{p(!1),x(e.message||"Error durante el login.")}).onWarning(e=>{a&&(a.textContent=e)});function p(e){f&&w&&v&&(f.disabled=e,w.style.display=e?"none":"block",v.style.display=e?"flex":"none"),E&&(E.style.display=e?"block":"none"),l&&(l.style.display=e?"none":"block")}function C(e,n){if(!e)return;[d,u,g,y].forEach(t=>{if(t){t.classList.remove("opacity-50"),t.classList.add("opacity-50");const m=t.querySelector(".loading-step-icon");m&&(m.innerHTML='<div class="h-6 w-6 rounded-full bg-slate-600"></div>')}}),e.classList.remove("opacity-50"),e.classList.add("border-sky-500","bg-sky-900/20");const o=e.querySelector(".loading-step-icon");o&&(o.innerHTML=`
            <svg class="animate-spin h-6 w-6 text-sky-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          `),a&&(a.textContent=n)}function i(e){if(!e)return;e.classList.remove("border-sky-500","bg-sky-900/20"),e.classList.add("border-green-500","bg-green-900/20");const n=e.querySelector(".loading-step-icon");n&&(n.innerHTML=`
            <svg class="h-6 w-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
          `)}function x(e){s&&h&&(h.textContent=e,s.classList.remove("hidden"))}function _(){s&&s.classList.add("hidden")}l?.addEventListener("submit",async e=>{e.preventDefault(),_();const o=document.getElementById("username")?.value.trim();if(o)try{p(!0),await S.execute(async()=>{if(!c.getAuthPort().isKeychainAvailable())throw new Error("Hive Keychain no está instalado. Asegúrate de instalar la extensión del navegador.");if(i(d),!await c.getHiveRepository().getAccount(o))throw new Error("La cuenta no existe en Hive");i(u);try{await I.login(o),i(g);const r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o})});if(!r.ok){const T=await r.json();throw new Error(T.error||"Error al crear sesión")}const b=await r.json();if(!b.success)throw new Error(b.error||"Error al crear sesión");return!0}catch(r){throw r.message.includes("User denied")?new Error("Autenticación cancelada por el usuario"):r.message.includes("popup")?new Error("Hive Keychain no pudo abrirse. Verifica que no esté bloqueado por el navegador."):new Error("Error con Hive Keychain: "+r.message)}})}catch(t){p(!1),x(t.message||"Error durante el login.")}})});
