---
import '../styles/global.css';
import { ViewTransitions } from 'astro:transitions';

export interface Props {
  title?: string;
  description?: string;
}

const { title = 'Aliento.pay', description = 'Hive Delegation Tracker' } = Astro.props;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <meta name="description" content={description} />
    <ViewTransitions />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="font-sans text-white scrollbar-brand">
    <!-- Fixed background that covers full viewport always -->
    <div class="fixed inset-0 bg-brand-bg">
      <!-- Background pattern overlay -->
      <div class="absolute inset-0 opacity-5 bg-pattern-dots"></div>
    </div>
    
    <!-- Main content with proper z-index -->
    <div class="relative z-10 min-h-screen">
      <slot />
    </div>
  </body>
</html>

<script>
  // Script global para manejar las transiciones de Astro
  let isInitialized = false;

  function handlePageTransition() {
    console.log('游댃 Astro: Transici칩n de p치gina detectada');

    // Marcar como no inicializado para forzar re-inicializaci칩n
    isInitialized = false;

    // Limpiar cualquier marca de inicializaci칩n en elementos
    const elementsWithInit = document.querySelectorAll('[data-initialized="true"]');
    elementsWithInit.forEach(el => {
      el.removeAttribute('data-initialized');
    });

    // Triggerar evento personalizado para que los componentes se reinicialicen
    setTimeout(() => {
      const customEvent = new CustomEvent('aliento:page-ready');
      document.dispatchEvent(customEvent);
    }, 100);
  }

  // Eventos de Astro para View Transitions
  document.addEventListener('astro:page-load', handlePageTransition);
  document.addEventListener('astro:after-swap', handlePageTransition);

  // Evento para carga inicial
  document.addEventListener('DOMContentLoaded', handlePageTransition);
</script>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
    font-family: 'Inter', ui-sans-serif, system-ui, sans-serif;
  }
  
  /* Smooth scrolling */
  html {
    scroll-behavior: smooth;
  }
  
  /* Prevent flash of unstyled content */
  body {
    opacity: 0;
    animation: fadeIn 0.3s ease-in-out forwards;
  }
  
  @keyframes fadeIn {
    to {
      opacity: 1;
    }
  }
</style>
